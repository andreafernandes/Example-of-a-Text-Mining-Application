{"name":"Appetite-textmining-code","tagline":"Using GATE to text mine 'appetite'","body":"# appetite-textmining-code\r\n\r\n\r\n**Using Text mining software - [GATE](https://gate.ac.uk/family/) - to extract a data variable from free text clinical notes.**\r\n\r\n\r\nThis repo is a record of my [JAPE](https://gate.ac.uk/sale/tao/splitch8.html#chap:jape) code to text mine the variable \"appetite\" within a bespoke psychiatric health record database, [CRIS](http://www.slam.nhs.uk/about/core-facilities/cris). \r\n\r\nIt is mainly for my own records and this archive functions as a link to send out to anyone interested. \r\n\r\nDo feel free to contact me for suggestions, questions or constructive feedback!\r\n\r\n\r\n##About Author\r\n\r\n\r\n###Details and Contact Information\r\n| Author Name | Andrea Fernandes| \r\n|:--------|:--------------|\r\n|Occupation| PhD student, 2nd Year|\r\n|Email | andrea.fernandes@kcl.ac.uk|\r\n|University|King's College London|\r\n|Funding| MHRUK - Mental Health Research UK|\r\n\r\n**********\r\n\r\n\r\n**Purpose of 'Appetite Variable'**   \r\nThis code will highlight the term 'appetite' AND any terms which collectively describe either 'good' or 'poor' appetite.\r\n\r\n\r\n| Data source         | [CRIS](http://www.slam.nhs.uk/about/\t\t\t\t\t\t\tcore-facilities/cris) - Pseudonymised \t\t\t\t\t\t\telectronic psychiatric healthcare \t\t\t\t\t\t\trecords| \r\n|:--------------------|:------------|\r\n|**Data extracted**       | **Clinical notes with the term \t\t\t\t\t\t\t'appetite' menioned were extracted \t\t\t\t\t\t\t and processed to be read by GATE. \t\t\t\t\t\t\t Contact author for details on this.** |\r\n|**Text-mining software** | **[GATE](www.gate.ac.uk)**|\r\n\r\n\r\n*************\r\n##Basic Steps\r\nI followed the **following steps** to create a functioning code to textmine appetite from CRIS records. \r\n\r\n**1) Define Problem**\r\n\r\nDefine and think through what it is you want to extract. Think of your variable outcome. What type of data would you like your outcome variable to display? What do you want this variable to inform you of? \r\n\r\nWrite a set of rules that \r\n\r\ni) define your variable of interest and \r\nii) what you want out of your textmining code eventually. Give some examples.\r\n\r\n\r\n**2) Scoping Exercise**\r\n\r\nTo help with understanding what it is what you want from the free-text data, conduct a scoping exercise. Go through around 500 to 1000 documents, relevant to your variable of interest. \r\n\r\nDuring this exercise, familiarise yourself with how your variable of interest is being mentioned, what are common terms/words associated with this variable. What terms make your variable of interest redundant or negate the variable. \r\n\r\n**3) Re-define Problem**\r\n\r\nAfter doing the scoping exercise, go back to your definition of and make any changes that you think will make your definition of the problem explicit. Give examples and lists of terms if you think it will help with the definition. \r\n\r\n**4) Thorough Consultation Process**\r\n\r\nSet up a thorough consultation with relevant colleagues and supervisors (and experts in the field) at this point to make sure you've covered your bases with defining your variable of interest. Make any revisions at this point to your document. \r\n\r\n**At this stage you should happy with the definition of the Variable. You should have thought about and developed resolutions to all possible scenarios in which your variable could be mentioned in free-text.**\r\n\r\n**5) Extract documents for Training Set and Gold Standard.** \r\n\r\nExtract 500 documents for each set.\r\n\r\n**6) Annotate Training Set and Gold Standard**\r\n\r\nBased on your document from 3) annotate the Training Set and Gold Standard sets on the same day. \r\n\r\nIf the variable your interested is complicated, you should get two annotators to annotate your Training Set and check Inter-rater Reliability to minimise bias or skewed annotations. \r\n\r\n**7) Write JAPE and Create Gazateers**\r\n\r\nBased on Training Set and Scoping Exercise Begin to Write JAPE and Create Necessary Gazateers. You can continuously test your JAPE and Gazateers out on smaller document sets to make sure the JAPE is doing what you want it to do. \r\n\r\n**8) Evaluate Application**\r\n\r\nTest out final Gazateer list and JAPE on Gold-Standard\r\n\r\n\r\n\r\n*************\r\n##GATE Application to Extract Appetite\r\n\r\n\r\n**Result of Scoping Exercise**\r\n\r\nRules to code appetite were generated were kept as simple as possible: ![GOLD STANDARD RULES](https://cloud.githubusercontent.com/assets/10629155/12238166/95b70598-b87a-11e5-9fe6-dcefe1bd904b.png) \r\n\r\n#### GAZATEERS\r\n\r\nA Gazateer is - basically -  a list of terms stored in a .lst file. \r\n\r\nI used 5 gazateers to help me pick up \"good\" or \"bad appetite\" (The list of terms were derived from scoping exercises on CRIS, whose aim was to determine the types of words used to describe appetite in CRIS). \r\n\r\nHere's the list of .lst files I generated. These are in the \"gazateer\" repository: \r\n\r\n\r\n\r\n###### Gazateer 1: appetite_gazateer.lst file \r\n\r\n###### Gazateer 2: appetite poor describe.lst \r\n\r\n###### Gazateer 3: appetite good describe.lst\r\n\r\n###### Gazateer 4: negation.lst\r\n\r\n###### Gazateer 5: symptom_gazateer.lst \r\n\r\n\r\nThese .lst files are then saved into a single  .def file, which looks like so:\r\n\r\n\r\n```\r\nappetite_gazateer.lst:appetite_mention\r\nappetite_poor_describe.lst:appetite_description:poor\r\nappetite_good_describe.lst:appetite_description:good\r\nnegation.lst:negationterms:negation\r\nsymptom_gazateer.lst:Symptom:symptoms\r\n```\r\n\r\n\r\n\r\n#### JAPE CODE\r\n\r\nThis jape code was written after going through the Training set data (500 documents) and generating a set of \"patterns\" or themes in the text that appeared consistently or often in the documents, when describing appetite. \r\n\r\nBased on the themes I wrote the following JAPE code, in chunks. I have each chunk priority to be run, according to how often these themes were mentioned in the text.\r\n\r\n\r\n\r\n######FINAL JAPE code\r\n\r\n\r\n```\r\nPhase: Appetite\r\nInput: Lookup Token Split\r\nOptions: control = appelt\r\n\r\n\r\n\r\nRule: AppetiteThenDescriber\r\nPriority: 10\r\n\r\n(\r\n\r\n\t({Token.string =~ \"[Aa]ppetite\", !Lookup.MajorType == \"Symptom\"}):SymptomAppetiteOnly\r\n\r\n\t({Lookup.minorType == \"good\"} | \r\n \t {Lookup.minorType == \"poor\"}):descriptorsOfAppetite\r\n\r\n):AppetiteDescription\r\n-->\r\n:AppetiteDescription.Appetite = {rule = \"AppetiteDescription1\", AppetiteType = :descriptorsOfAppetite.Lookup.minorType, ApplyNegation = \"no\"}\r\n\r\n\r\n\r\n\r\nRule: AppetiteThenDescriber\r\nPriority: 9\r\n(\r\n\r\n\t({Token.string =~ \"[Aa]ppetite\", !Lookup.MajorType == \"Symptom\"}):SymptomAppetiteOnly\r\n\r\n\t {Token.category == \":\", Token.category != \",\"} \r\n\t({Lookup.minorType == \"good\"} | \r\n  \t {Lookup.minorType == \"poor\"}):descriptorsOfAppetite\r\n\r\n):AppetiteDescription\r\n-->\r\n:AppetiteDescription.Appetite = {rule = \"AppetiteDescription2\", AppetiteType = :descriptorsOfAppetite.Lookup.minorType, ApplyNegation = \"no\"}\r\n\r\n\r\n\r\n\r\nRule: DescriberThenAppetite\r\nPriority: 9\r\n(\r\n\r\n\t({Lookup.minorType == \"good\"} | \r\n\t {Lookup.minorType == \"poor\"}):descriptorsOfAppetite\r\n\t {Token.category != \",\"}\r\n\t({Token.string =~ \"[Aa]ppetite\", !Lookup.MajorType == \"Symptom\"}):SymptomAppetiteOnly\r\n\r\n):AppetiteDescription\r\n-->\r\n:AppetiteDescription.Appetite = {rule = \"AppetiteDescription3\", AppetiteType = :descriptorsOfAppetite.Lookup.minorType, ApplyNegation = \"no\"}\r\n\r\n\r\n\r\n\r\nRule: DescriberThenAppetite\r\nPriority: 8\r\n(\r\n\r\n\t({Lookup.minorType == \"good\"} | \r\n\t {Lookup.minorType == \"poor\"}):descriptorsOfAppetite\r\n\t {Token.category != \",\"}\r\n\t({Token,!Split})[0,3]\r\n\t({Token.string =~ \"[Aa]ppetite\", !Lookup.MajorType == \"Symptom\"}):SymptomAppetiteOnly\r\n\r\n):AppetiteDescription\r\n-->\r\n:AppetiteDescription.Appetite = {rule = \"AppetiteDescription4\", AppetiteType = :descriptorsOfAppetite.Lookup.minorType, ApplyNegation = \"no\"}\r\n\r\n\r\n\r\n\r\nRule: AppetiteThenDescriber\r\nPriority: 7\r\n(\r\n\r\n\t({Token.string =~ \"[Aa]ppetite\", !Lookup.MajorType == \"Symptom\"}):SymptomAppetiteOnly\r\n\t({Token,!Split})[0,3]\r\n\t {Token.category != \",\"}\r\n\t({Lookup.minorType == \"good\"} | \r\n\t {Lookup.minorType == \"poor\"}):descriptorsOfAppetite\r\n\r\n):AppetiteDescription\r\n-->\r\n:AppetiteDescription.Appetite = {rule = \"AppetiteDescription5\", AppetiteType = :descriptorsOfAppetite.Lookup.minorType, ApplyNegation = \"no\"}\r\n\r\n\r\n\r\n\r\nRule: AppetiteThenDescriber\r\nPriority: 7\r\n(\r\n\r\n\t({Lookup.minorType == negation}):Negationwords\r\n\t({Token,!Split})[0,3]\r\n\t({Lookup.minorType == \"good\"}  | \r\n\t {Lookup.minorType == \"poor\"}):descriptorsOfAppetite\r\n\t({Token,!Split})[0,3]\r\n\t({Token.string =~ \"[Aa]ppetite\", !Lookup.MajorType == \"Symptom\"}):SymptomAppetiteOnly\r\n\r\n):AppetiteDescriptionwithNegation\r\n-->\r\n:AppetiteDescriptionwithNegation.Appetite = {rule = \"AppetiteDescriptionwithNegation6\", AppetiteType = :descriptorsOfAppetite.Lookup.minorType, ApplyNegation = \"yes\"}\r\n\r\n\r\n\r\n\r\nRule: AppetiteThenDescriber\r\nPriority: 6\r\n(\r\n\r\n\t({Token.string =~ \"[Aa]ppetite\", !Lookup.MajorType == \"Symptom\"}):SymptomAppetiteOnly\t\r\n\t({Token,!Split})[0,3]\r\n\t({Lookup.minorType == negation}):Negationwords\r\n\t({Token,!Split})[0,3]\r\n\t({Lookup.minorType == \"good\"}  | \r\n\t {Lookup.minorType == \"poor\"}):descriptorsOfAppetite\r\n\r\n):AppetiteDescriptionwithNegation\r\n-->\r\n:AppetiteDescriptionwithNegation.Appetite = {rule = \"AppetiteDescriptionwithNegation7\", AppetiteType = :descriptorsOfAppetite.Lookup.minorType, ApplyNegation = \"yes\"}\r\n\r\n\r\n\r\n\r\nRule: AppetiteThenDescriber\r\nPriority: 6\r\n(\r\n\r\n\t({Token.string =~ \"[Nn]o\"})\r\n\t({!Token.string == \"change\"})\r\n\t({Token,!Split})[0,3]\r\n\t({Token.string =~ \"[Aa]ppetite\", !Lookup.MajorType == \"Symptom\"}):SymptomAppetiteOnly\r\n\t({Token.string =~ \"[Pp]roblems\"})\r\n\r\n):AppetiteDescriptionwithNegation\r\n-->\r\n:AppetiteDescriptionwithNegation.Appetite = {rule = \"AppetiteDescriptionwithNegation8\", AppetiteType = \"good\" ApplyNegation = \"no\"}\r\n```\r\n \r\n\r\n\r\n***********************************\r\n## Testing the Application\r\n\r\nWe need to some Gold Standard data to test the above Gazateers and Code. \r\n\r\n### Gold Standard data \r\n\r\n500 documents extracted from CRIS. Each document contains the word \"appetite\"\r\n\r\nThese documents were annotated by two individuals to code good or bad appeite accoding to the **GOLD STANDARD RULES**\r\n\r\nI didnt perform inter-rater reliability test because it is a simple application. \r\n\r\n\r\n###Final Performance\r\n\r\nTesting on Gold Standard data (500 documents) generated a **_Precision_** of **80%** and a **_Recall_** of **73%.**\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}